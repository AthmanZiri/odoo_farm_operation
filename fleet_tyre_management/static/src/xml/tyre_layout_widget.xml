<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">
    <t t-name="fleet_tyre_management.TyreLayoutWidget" owl="1">
        <div class="o_tyre_layout_widget p-4 bg-light rounded shadow-sm">
            <div t-if="!state.data.units || state.data.units.length === 0" class="text-center text-muted">
                No Axle Configuration selected or data missing.
            </div>

            <div t-else="" class="d-flex flex-column align-items-center gap-3">
                <t t-foreach="state.data.units" t-as="unit" t-key="unit_index">
                    <!-- Unit Connector (for trailers) -->
                    <div t-if="unit_index > 0" class="unit-connector bg-dark" style="width: 10px; height: 30px;"/>

                    <!-- Unit Container -->
                    <div class="unit-container d-flex flex-column align-items-center">
                        <div class="unit-label text-uppercase fw-bold small text-muted mb-2" t-esc="unit.label"/>
                        
                        <div class="chassis-frame position-relative d-flex flex-column gap-5 py-3 border-start border-end border-dark border-4" style="width: 200px; min-height: 100px;">
                            
                            <t t-foreach="Object.keys(unit.axles).sort()" t-as="axle_num" t-key="axle_num">
                                <div class="axle-row d-flex justify-content-between align-items-center px-0 position-relative">
                                    <div class="axle-line bg-secondary position-absolute w-100" style="height: 4px; top: 50%; z-index: 0;"/>

                                    <!-- Left Side Slots -->
                                    <div class="slots-left d-flex gap-1" style="z-index: 1;">
                                        <t t-foreach="unit.axles[axle_num].left" t-as="slot" t-key="slot.position_id">
                                            <div t-attf-class="tyre-slot position-relative border border-2 border-dark rounded-1 cursor-pointer transition-all hover-scale bg-{{slot.color_class}}"
                                                 t-att-title="slot.tyre_name ? slot.position_name + ': ' + slot.tyre_name + ' (' + slot.tread + 'mm)' : slot.position_name + ': Empty'"
                                                 style="width: 30px; height: 50px;"
                                                 t-on-click="() => this.onSlotClick(unit, slot)">
                                                <div t-if="slot.tyre_name" class="tread-indicator position-absolute bottom-0 w-100 bg-white opacity-25" t-attf-style="height: {{slot.tread * 2}}%; max-height: 100%;"/>
                                                <span class="slot-code position-absolute top-50 start-50 translate-middle smallest text-center fw-bold" style="font-size: 8px; pointer-events: none;">
                                                    <t t-esc="slot.position_code"/>
                                                </span>
                                            </div>
                                        </t>
                                    </div>

                                    <!-- Center Slot (e.g. Motorcycles) -->
                                    <div class="slots-center" style="z-index: 1;">
                                        <t t-foreach="unit.axles[axle_num].center" t-as="slot" t-key="slot.position_id">
                                            <div t-attf-class="tyre-slot position-relative border border-2 border-dark rounded-1 cursor-pointer transition-all hover-scale bg-{{slot.color_class}} bg-white-hider"
                                                 t-att-title="slot.tyre_name ? slot.position_name + ': ' + slot.tyre_name : slot.position_name + ': Empty'"
                                                 style="width: 30px; height: 50px;"
                                                 t-on-click="() => this.onSlotClick(unit, slot)">
                                                <span class="slot-code position-absolute top-50 start-50 translate-middle smallest text-center fw-bold" style="font-size: 8px; pointer-events: none;">
                                                    <t t-esc="slot.position_code"/>
                                                </span>
                                            </div>
                                        </t>
                                    </div>

                                    <!-- Right Side Slots -->
                                    <div class="slots-right d-flex gap-1" style="z-index: 1;">
                                        <t t-foreach="unit.axles[axle_num].right.slice().reverse()" t-as="slot" t-key="slot.position_id">
                                            <div t-attf-class="tyre-slot position-relative border border-2 border-dark rounded-1 cursor-pointer transition-all hover-scale bg-{{slot.color_class}}"
                                                 t-att-title="slot.tyre_name ? slot.position_name + ': ' + slot.tyre_name + ' (' + slot.tread + 'mm)' : slot.position_name + ': Empty'"
                                                 style="width: 30px; height: 50px;"
                                                 t-on-click="() => this.onSlotClick(unit, slot)">
                                                <div t-if="slot.tyre_name" class="tread-indicator position-absolute bottom-0 w-100 bg-white opacity-25" t-attf-style="height: {{slot.tread * 2}}%; max-height: 100%;"/>
                                                <span class="slot-code position-absolute top-50 start-50 translate-middle smallest text-center fw-bold" style="font-size: 8px; pointer-events: none;">
                                                    <t t-esc="slot.position_code"/>
                                                </span>
                                            </div>
                                        </t>
                                    </div>

                                </div>
                            </t>
                        </div>
                    </div>
                </t>
            </div>
        </div>
    </t>
</templates>
